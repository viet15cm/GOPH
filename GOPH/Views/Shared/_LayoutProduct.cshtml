@inject IHttpContextAccessor _httpcontext;

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    var domain = string.Format("{0}://{1}", _httpcontext.HttpContext.Request.Scheme, _httpcontext.HttpContext.Request.Host.ToString());

}

@section FacebookSharedHead{
    @await RenderSectionAsync("FacebookSharedHead", required: false)
}

<div class="container-fluid mt-3">
   
    <div class="bd-left">
        <aside class="bd-sidebar">
            <div class="menu-group-big">
                @RenderSection("MenuGroups", required: false)
            </div>
            
        </aside>
    </div>
    <div class="bd-right">
        <div class="header-title">
            <div class="curent-link">

                <ul>
                    <li>
                        <a asp-action="index" asp-controller="home"><i class="bi bi-house-door"></i>Trang chủ</a>
                    </li>
                    <li><a>/</a></li>
                    <li>
                        <a href="#">Thuốc</a>
                    </li>
                </ul>
            </div>

            <div class="curent-date">
                <p></p>
            </div>

        </div>

        <input type="hidden" id="domain" value="@domain" />
        <input type="hidden" id="number-page" value="1" />
        @RenderBody()
        <div id="loader" class="loader"></div>
    </div>
    
</div>

<div class="offcanvas offcanvas-start" tabindex="-1" id="menuSmallGroups" aria-labelledby="offcanvasExampleLabel">
    <div class="offcanvas-header">       
        <button style="position: absolute; top: 20px; right: 15px;" type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
        @RenderSection("MenuSmallGroups", required: false)
    </div>
</div>

@section NavbarCart{
    <nav id="navbar-search" class="navbar navbar-light navbar-search">

        <div class="container">

            <div class="navbar-below-left">
                <div class="navbar-below-icon">
                    <a class=" btn btn-light" data-bs-toggle="offcanvas" href="#menuSmallGroups" role="button" aria-controls="menuSmallGroups">
                        <i class="bi bi-list"></i>
                    </a>
                </div>
                
                <ul class="navbar-below-menu">

                    <li ><a >demo</a></li>
                    <li ><a>demo</a></li>
                    <li ><a>demo</a></li>
                    <li ><a>demo</a></li>

                </ul>
            </div>
          
           

                <div class="navbar-below-right">

                <form id="submit-search" method="post" asp-action="searchindex">
                        <div class="search-input">
                            
                            <input id="name-list" type="search" aria-label="Search" placeholder="Tên sản phẩm" name="search">
                            <input type="hidden" id="hfProduct" name="productId" />

                            <div id="autocom-box" class="autocom-box">
                                <!-- here list are inserted from javascript -->
                            </div>
                            <button id="icon-search" class="icon-search" type="submit"><i class="bi bi-search"></i></button>
                            <button  id="icon-load" class="icon-search"><img style="width: 30px; height:30px;" src="~/iconcontan/load.gif"/></button>
                        </div>
                        
                    </form>
                    <ul class="cart">
                        <li>
                            <a asp-area="" asp-controller="cart" asp-action="index" class="position-relative">
                                <i class="bi bi-cart4"></i>
                                <span class="position-absolute start-100 translate-middle badge rounded-pill bg-danger rounded-circle">
                                    15
                                    <span class="visually-hidden">unread messages</span>
                                </span>
                            </a>
                        </li>

                    </ul>
           </div>
            
          
        </div>

    </nav>
}
@section HostPhone{
    <div class="float-contact">
        <div class="call-hotline">
            <a href="tel:0869836386"><img title="Call Hotline" src="~/Iconcontan/icon-phone.png" alt="phone-icon" width="40" height="40" /></a>
        </div>
        <div class="chat-facebook">
            <a href="https://m.me/themewp.vn" target="_blank"><img title="Chat Facebook" src="~/Iconcontan/icon-facebook.png" alt="facebook-icon" width="40" height="40" /></a>
        </div>
        <div class="chat-zalo">
            <a href="https://zalo.me/0869836386" target="_blank"><img title="Chat Zalo" src="~/Iconcontan/zalo-icon.png" alt="zalo-icon" width="40" height="40" /></a>
        </div>
    </div>
}

@section Scripts{

    @await RenderSectionAsync("Scripts", required: false)

    <script>

        window.onscroll = function () { myFunction() };

        var navbar = document.getElementById("navbar-search");
        var menuSmallGroups = document.getElementById("menuSmallGroups");
        var mainhtm = document.getElementById("main");
        var sticky = navbar.offsetTop;

        function myFunction() {

            if (window.pageYOffset >= sticky) {
                navbar.classList.add("sticky");
                menuSmallGroups.classList.add("mt-5")
                mainhtm.classList.add("magin");
               
            } else {
                navbar.classList.remove("sticky");
                menuSmallGroups.classList.remove("mt-5")
                mainhtm.classList.remove("magin");
            }
        }


        var _throttleTimer = null;
        var _throttleDelay = 100;
        var $window = $(window);
        var $document = $(document);

        var object = Number(document.getElementById("number-page").value);
        $document.ready(function () {

            $window
                .off('scroll', ScrollHandler)
                .on('scroll', ScrollHandler);

        });

        function ScrollHandler(e) {
            //throttle event:
            clearTimeout(_throttleTimer);
            _throttleTimer = setTimeout(function () {
                console.log('scroll');

                //do work
                if ($window.scrollTop() + $window.height() > $document.height() - 100) {

                    document.getElementById("loader").style.display = "block";
                    object = object + 1;
                    document.getElementById("number-page").value = object;
                    showDrop(object) 
                }

            }, _throttleDelay);
        }



        function showDrop(object) {
           
            var numberpage = object;
            var domain = document.getElementById("domain").value;
            var group = document.getElementById("router-id").value;
          
            debugger
            $.ajax({
                url: domain + '/home/showCardProductPartial',
                contentType: 'application/html; charset=utf-8',
                data: { pageNumber: numberpage, groupId: group },
                type: 'GET',
                dataType: 'html',
                success: function (response) {
                    debugger
                    $("#list-card-product").append(response);
                    document.getElementById("loader").style.display = "none";
                },
                error: function (response) {
                    debugger
                    alert(response);
                }
            });
        }
    </script>

    @*<script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.10.0.min.js" type="text/javascript"></script>
    <script src="https://ajax.aspnetcdn.com/ajax/jquery.ui/1.9.2/jquery-ui.min.js" type="text/javascript"></script>*@
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

    <script>

       

        $(function () {
            var domain = document.getElementById("domain").value;
            $('#name-list').autocomplete({
                source: function (request, response) {
                    document.getElementById("icon-load").style.display = "block";
                   
                    debugger
                    $.ajax({
                        url: domain + "/Home/Search",
                        data: { "prefix": request.term },
                        dataType: "json",
                        type: "POST",
                        success: function (data) {
                            document.getElementById("icon-load").style.display = "none";
                            console.log(data);
                            response(data);
                        },
                        error: function (response) {
                            alert(response.responseText);
                        },
                        failure: function (response) {
                            alert(response.responseText);
                        }
                    })
                },
                appendTo: "#autocom-box",
                select: function (e, i) {
                    
                    $("#hfProduct").val(i.item.val);
                    document.getElementById("submit-search").submit();
                },
                minLength: 1
            }).autocomplete("instance")._renderItem = function (ul, item) {
                
               
                console.log('test');
                var item = $('<div class="list_item_container d-flex flex-row bd-highlight mb-3"><div class="image-search-box"><img class="imageClass p-2 bd-highlight" src="' + item.logoUrl + '"></div><div class="label-item-search p-2 bd-highlight">' + item.label + '</div></div>')
                return $("<li>").append(item).appendTo(ul);
            };
        });
    </script>
}